import{r as o,a,s as P,j as e,b as I,R as Y,F as D,u as z,I as O,c as V,d as K,L as Z}from"./index-e09b3632.js";import{n as $,a as ee}from"./toast-1c021ce3.js";import{m as te,p as ae}from"./plus-9f102ee5.js";const re=()=>{const[t,c]=o.useState([]),[u,d]=o.useState([]),[r,y]=o.useState([]),[b,N]=o.useState(""),[g,C]=o.useState(""),[m,s]=o.useState(""),[h,n]=o.useState(""),[i,l]=o.useState(""),[p,f]=o.useState(""),w=o.useMemo(()=>["Cash","Credit Card"]),T=o.useMemo(()=>["Phone","Email"]);o.useEffect(()=>{const _="https://provinces.open-api.vn/api/?depth=3";(async()=>{const X=await(await fetch(_)).json();c(X)})()},[]);const Q=_=>{const[A]=t.filter(k=>k.code===_);N(A.name),d(A.districts),y([]),C(""),s("")},U=_=>{const[A]=u.filter(k=>k.code===_);C(A.name),y(A.wards),s("")},j=_=>{const[A]=r.filter(k=>k.code===_);s(A.name)},R=_=>{const[A]=w.filter(k=>k===_);n(A)},W=_=>{const[A]=T.filter(k=>k===_);l(A)},J=_=>{f(_.target.value)};function G(_){return/(03|05|07|08|09|01[2|6|8|9])+([0-9]{8})\b/.test(_)}return{listProvince:t,listDistrict:u,listWard:r,listPaymentMethod:w,listOrderConfirmMethod:T,selectedProvince:b,selectedDistrict:g,selectedWard:m,selectedPaymentMethod:h,selectedOrderConfirmMethod:i,selectProvinceHandler:Q,selectDistrictHandler:U,selectWardHandler:j,selectPaymentMethodHandler:R,selectOrderConfirmMethodHandler:W,phoneNumber:p,phoneNumberChangeHandler:J,validatePhoneNumber:G}},B=t=>{const c=o.useRef();return o.useEffect(()=>{const u=d=>{c.current&&!c.current.contains(d.target)&&t()};return document.addEventListener("click",u,!0),()=>{document.removeEventListener("click",u,!0)}},[c]),c},L="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAlCAQAAABYWSe8AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfhCAsOLCz3yoQAAAABF0lEQVRYw+2WP27CMBSHP0TkwgIp5XhIXAJxBTrSveoAFwA6tLkA/6GngYopHVJBYoJUv9QOg3+ZMrz3fbbs5IGPj8+dp0pQqD6gKi+u8MyBI0OUqF7xwjcHBlRkAl3i32ciUFBMzvUdmcDbuUHM1FBBMU1Vv8oE+qkWMTMDBcUsU9uTCdTZixR0/J669BiGbDKtPqgZbn7MF+0i1yhkbaRwjX8q+iUwUbCAN1GwhE8UVpnWnzkK10fv3/B/UbCMB2hqClHqcineNXzLxo+pyTJX4UHD7+zgbyk4xOedhYgo874itD0h6LvgcPUXhUUufusGf0thy6PLUa2hKTjGJwrzMvGJwpgTJ0Y0ypuag4JTs4+PT/n5AYSEBXTG1HbKAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE3LTA4LTExVDE0OjQ0OjQ0KzAwOjAwq05UKQAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNy0wOC0xMVQxNDo0NDo0NCswMDowMNoT7JUAAAAASUVORK5CYII=",H=({label:t="",selectHandler:c=()=>{},selected:u="",listOption:d=[]})=>{const[r,y]=o.useState(!1),[b,N]=o.useState(-1),C=B(()=>{y(!1)}),m=d.map(s=>{const h=s.name.replace(/(Thành phố |Thành Phố |Tỉnh |Quận |Huyện |Thị xã |Thị Xã |Xã |Thị trấn |Phường )/g,"");return{...s,name:h}});return a("div",{className:P.select,ref:C,children:[e("h3",{className:P.label,children:t}),a("div",{className:`${P["select-menu"]} ${r?P.active:""}`,onClick:()=>y(!r),children:[a("div",{className:P.selected,children:[e("h3",{children:u||`Select ${t.toLowerCase()}`}),e("img",{src:L,alt:"icon"})]}),e("ul",{className:`${P["dropdown-menu"]} ${r?P.active:""}`,children:m.map((s,h)=>e("li",{className:`${P["dropdown-item"]} ${b===s.code?P.active:""}`,onClick:n=>{n.stopPropagation(),c(s.code),N(s.code),y(!1)},children:s.name},s.code||h))})]})]})},ne=({label:t="",selectHandler:c=()=>{},selected:u="",listOption:d=[]})=>{const[r,y]=o.useState(!1),[b,N]=o.useState(null),g=["Credit Card"],m=B(()=>{y(!1)});return a("div",{className:I.select,children:[e("h3",{className:I.label,children:t}),a("div",{className:`${I["select-menu"]} ${r?I.active:""}`,onClick:()=>y(!r),ref:m,children:[a("div",{className:I.selected,children:[e("h3",{children:u||`Select ${t.toLowerCase()}`}),e("img",{src:L,alt:"icon"})]}),e("ul",{className:`${I["dropdown-menu"]} ${r?I.active:""}`,children:d.map((s,h)=>e("li",{className:`${I["dropdown-item"]} ${b!==s?"":I.active} ${g.includes(s)?I.disable:""}`,onClick:g.includes(s)?()=>{$("We are currently working on improving this feature. Please try again later!",5)}:n=>{n.stopPropagation(),c(s),N(s),y(!1)},children:s},h))})]})]})},se="_cart_3zeob_1",S={cart:se,"cart-container":"_cart-container_3zeob_15","cart-infomation":"_cart-infomation_3zeob_39","cart-summary":"_cart-summary_3zeob_41","summary-list":"_summary-list_3zeob_55","cart-summary-total":"_cart-summary-total_3zeob_81","cart-button-home":"_cart-button-home_3zeob_115","cart-button-checkout":"_cart-button-checkout_3zeob_155"},F={"cart-list":"_cart-list_1nsb2_1","cart-fields":"_cart-fields_1nsb2_27"},ce=o.memo(({cartList:t,addToCart:c,removeFromCart:u})=>a("div",{className:F["cart-list"],children:[a("div",{className:F["cart-fields"],children:[e("h4",{children:"Images"}),e("h4",{children:"Name"}),e("h4",{children:"Size"}),e("h4",{children:"Quantity"}),e("h4",{children:"Price"})]}),t.map(d=>e(ue,{item:d,addToCart:c,removeFromCart:u},d.id))]})),oe="_overlay_ocer5_1",ie="_action_ocer5_71",q={overlay:oe,"modal-remove-from-cart":"_modal-remove-from-cart_ocer5_15","modal-container":"_modal-container_ocer5_37","btn-close":"_btn-close_ocer5_59",action:ie,"btn-cancel":"_btn-cancel_ocer5_83"},le=({open:t,onClose:c,removeFromCart:u})=>t?Y.createPortal(a(D,{children:[e("div",{className:q.overlay,onClick:c}),e("div",{className:`container ${q["modal-remove-from-cart"]}`,onClick:d=>{d.stopPropagation()},children:a("div",{className:`${q["modal-container"]}`,children:[e("button",{type:"button",onClick:c,className:q["btn-close"],children:"X"}),e("h2",{className:"section-heading",children:"Are you sure?"}),e("p",{children:"You are already to delete items from cart."}),a("div",{className:q.action,children:[e("button",{className:`${q["btn-cancel"]} btn`,onClick:c,type:"button",children:"Cancel"}),e("button",{type:"button",className:`${q["btn-cancel"]} btn`,onClick:()=>{u(),c()},children:"Delete"})]})]})})]}),document.getElementById("portal")):null,v={"cart-box":"_cart-box_1axpf_1","cart-box-img":"_cart-box-img_1axpf_27","cart-box-name":"_cart-box-name_1axpf_37","cart-box-size":"_cart-box-size_1axpf_45","cart-box-quantity":"_cart-box-quantity_1axpf_55","cart-box-quantity-flex":"_cart-box-quantity-flex_1axpf_67","btn-quantity":"_btn-quantity_1axpf_77","is-delete":"_is-delete_1axpf_121","cart-box-quantity-input":"_cart-box-quantity-input_1axpf_143","cart-box-price":"_cart-box-price_1axpf_159","cart-box-price-sale":"_cart-box-price-sale_1axpf_175","cart-box-price-original":"_cart-box-price-original_1axpf_191","not-sale":"_not-sale_1axpf_207"},de=({item:t,addToCart:c,removeFromCart:u})=>{const{currentUser:d}=z(),r=o.useMemo(()=>t.cartInfo,[d]),[y,b]=o.useState(null),[N,g]=o.useState(!1),C=Math.round(t.price-t.price*t.discount/100),m=o.useCallback(async(n,i,l)=>{if(r.findIndex(({sizeProductUser:w})=>w===i)<0)return;let f=+n.target.value;if(f<=0){$(`At least 1 product in cart. Your entered: ${f}`,5);return}else f>l.quantity&&(f=l.quantity,$(`Product in stocks: ${l.quantity}. Your cart is updated.`,5));await c(n,{productId:t.id,quantity:f,size:i,isEditQuantity:!0})},[r]),s=o.useCallback(async n=>{const i=r.findIndex(({sizeProductUser:l})=>l===n);if(!(i<0)){if(r[i].quantity===1){b(r[i].sizeProductUser),g(!0);return}await c(event,{productId:t.id,quantity:r[i].quantity-1,size:n,isEditQuantity:!0})}},[r]),h=o.useCallback(async(n,i,l)=>{const p=r.findIndex(({sizeProductUser:f})=>f===i);if(!(p<0)){if(r[p].quantity>l.quantity){$(`Product is maximum quantity. Product in stocks: ${l.quantity}.`,5);return}await c(n,{productId:t.id,quantity:r[p].quantity+1,size:i,isEditQuantity:!0})}},[r]);return a(D,{children:[e(le,{onClose:()=>{g(!1)},open:N,removeFromCart:n=>u(n,{productId:t.id,sizeProduct:y})}),a("div",{className:v["cart-box"],children:[e("div",{className:v["cart-box-img"],children:e("img",{src:t.images[0],alt:t.name})}),e("h4",{className:v["cart-box-name"],children:t.name}),e("div",{className:v["cart-box-size"],children:r.map(({sizeProductUser:n})=>e("p",{children:n},n))}),e("div",{className:v["cart-box-quantity"],children:r.map(({quantity:n,sizeProductUser:i},l)=>{const[p]=t.size.items.filter(({size:f})=>f===i);return a("div",{className:v["cart-box-quantity-flex"],children:[e("button",{className:`${v["btn-quantity"]} ${n==1?v["is-delete"]:null}`,onClick:()=>s(i),disabled:n<1,children:e("img",{src:te,alt:"minus icon"})}),e("input",{type:"tel",className:v["cart-box-quantity-input"],value:n>=p.quantity?p.quantity:n,onChange:f=>m(f,i,p)}),e("button",{className:v["btn-quantity"],onClick:()=>h(event,i,p),disabled:n>=p.quantity,children:e("img",{src:ae,alt:"plus icon"})})]},t.id+l)})}),a("div",{className:v["cart-box-price"],children:[t.discount>0?a("span",{className:v["cart-box-price-sale"],children:["$",C]}):null,a("span",{className:`${v["cart-box-price-original"]} ${t.discount?null:v["not-sale"]}`,children:["$",t.price]})]})]},t.id)]})},ue=de,E={"summary-list":"_summary-list_b1xoy_1","summary-fields":"_summary-fields_b1xoy_27"},me=o.memo(({cartList:t})=>a("div",{className:E["summary-list"],children:[a("div",{className:E["summary-fields"],children:[e("h4",{children:"Name"}),e("h4",{children:"Size"}),e("h4",{children:"Quantity"}),e("h4",{children:"Total"})]}),t.map(c=>e(pe,{item:c},c.id))]})),M={"summary-box":"_summary-box_lkjn6_1","summary-box-img":"_summary-box-img_lkjn6_27","summary-box-name":"_summary-box-name_lkjn6_37","summary-box-size":"_summary-box-size_lkjn6_45","summary-box-quantity":"_summary-box-quantity_lkjn6_57","summary-box-quantity-flex":"_summary-box-quantity-flex_lkjn6_69","summary-box-price":"_summary-box-price_lkjn6_79"},he=({item:t})=>{const c=Math.round(t.price-t.price*t.discount/100),u=t.cartInfo.reduce((d,r)=>d+r.quantity,0);return a("div",{className:M["summary-box"],children:[e("h4",{className:M["summary-box-name"],children:t.name}),e("div",{className:M["summary-box-size"],children:t.cartInfo.map(({sizeProductUser:d})=>e("p",{children:d},d))}),e("div",{className:M["summary-box-quantity"],children:t.cartInfo.map(({quantity:d},r)=>e("div",{className:M["summary-box-quantity-flex"],children:e("p",{children:d})},t.id+r))}),a("p",{className:M["summary-box-price"],children:["$",t.discount>0?c*u:t.price*u]})]},t.id)},pe=he,ye="_form_1o0ug_1",x={form:ye,"form-group":"_form-group_1o0ug_21","form-group-fields":"_form-group-fields_1o0ug_43","form-group-field":"_form-group-field_1o0ug_43","form-group-contacts":"_form-group-contacts_1o0ug_87","form-group-address":"_form-group-address_1o0ug_99","form-group-label":"_form-group-label_1o0ug_111"},fe=()=>{const{listProvince:t,listDistrict:c,listWard:u,listPaymentMethod:d,listOrderConfirmMethod:r,selectedProvince:y,selectedDistrict:b,selectedWard:N,selectedPaymentMethod:g,selectedOrderConfirmMethod:C,selectProvinceHandler:m,selectDistrictHandler:s,selectWardHandler:h,selectPaymentMethodHandler:n,selectOrderConfirmMethodHandler:i,phoneNumber:l,phoneNumberChangeHandler:p,validatePhoneNumber:f}=re();return a("form",{method:"post",className:x.form,children:[a("div",{className:x["form-group"],children:[a("div",{className:x["form-group-label"],children:[e("h3",{children:"Profile"}),e("p",{children:"This information will."})]}),a("div",{className:x["form-group-fields"],children:[a("div",{className:x["form-group-contacts"],children:[a("div",{className:x["form-group-field"],children:[e("label",{htmlFor:"fullname",children:"Fullname"}),e(O,{id:"fullname",type:"text",placeholder:"Enter your fullname...",sizeInput:"small"})]}),a("div",{className:x["form-group-field"],children:[e("label",{htmlFor:"phone",children:"Phone number"}),e(O,{id:"phone",type:"number",placeholder:"0123456789",onBlur:()=>f(l),onChange:p,value:l,sizeInput:"small"})]})]}),a("div",{className:x["form-group-address"],children:[e(H,{label:"city",selected:y,selectHandler:m,listOption:t},"city"),e(H,{label:"district",selected:b,selectHandler:s,listOption:c},"district"),e(H,{label:"ward",selected:N,selectHandler:h,listOption:u},"ward"),a("div",{className:x["form-group-field"],children:[e("label",{htmlFor:"fullname",children:"Street"}),e(O,{id:"street",type:"text",placeholder:"Enter your street...",sizeInput:"small"})]})]})]})]}),a("div",{className:x["form-group"],children:[a("div",{className:x["form-group-label"],children:[e("h3",{children:"Payment"}),e("p",{children:"Select your payment method you want."})]}),e("div",{className:x["form-group-fields"],children:e("div",{className:x["form-group-payment"],children:e(ne,{label:"payment method",selected:g,selectHandler:n,listOption:d},"paymentMethod")})})]})]})},xe=()=>{const{setCurrentUser:t,currentUser:c}=z(),{mutate:u}=V(),{mutate:d}=K(),[r,y]=o.useState(!1),b=o.useMemo(()=>Object.values(c.cart.itemsInfo.reduce((m,s)=>{const{id:h,quantity:n,sizeProductUser:i,...l}=s;return h in m?m[h].cartInfo.push({quantity:n,sizeProductUser:i}):m[h]={id:h,...l,cartInfo:[{quantity:n,sizeProductUser:i}]},m},{})),[c]),N=o.useMemo(()=>b.reduce((m,s)=>{const h=s.cartInfo.reduce((i,{quantity:l})=>i+l,0),n=Math.round(s.price-s.price*s.discount/100);return m+h*n},0),[b]),g=async(m,s)=>{m.preventDefault();const{productId:h,quantity:n,size:i,isEditQuantity:l}=s;try{const p=await u({variables:{inputProduct:{productId:h,quantity:+n,size:i,isEditQuantity:l}}});t(p.data.addToCart)}catch(p){return p.extensions.http.status===401&&setTimeout(()=>navigate("/login"),500),$(p.message),p}},C=async(m,{productId:s,sizeProduct:h})=>{var n,i;m.preventDefault();try{const l=await d({variables:{productId:s,sizeProduct:h}});t(l.data.removeProductFromCart),ee("Delete Succcess!")}catch(l){((i=(n=l==null?void 0:l.extensions)==null?void 0:n.http)==null?void 0:i.status)===401&&setTimeout(()=>navigate("/login"),500),$(l.message)}};return e("div",{className:S.cart,children:a("div",{className:`container ${S["cart-container"]}`,children:[a("div",{className:S["cart-infomation"],children:[e("h1",{children:r?"Check Out":"Shopping cart"}),r?e(fe,{}):e(ce,{cartList:b,addToCart:g,removeFromCart:C}),e(Z,{className:S["cart-button-home"],to:r?"/cart":"/",onClick:r?m=>{m.preventDefault(),y(!1)}:null,children:e("span",{children:r?"Back to Cart":"Back to Home"})})]}),a("div",{className:S["cart-summary"],children:[e("h1",{children:"Summary"}),e(me,{cartList:b}),a("div",{className:S["cart-summary-total"],children:[a("h3",{children:[e("span",{children:"Total:"})," $",N]}),e("button",{className:S["cart-button-checkout"],onClick:r?null:()=>y(!0),children:"Check out"})]})]})]})})};export{xe as default};
